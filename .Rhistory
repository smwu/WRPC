# Reduce classes if there are duplicated classes
if (K_red < dim(post_MCMC_out$pi_global)[2]) {
for (k in 1:K_red) {
# Find duplicated modal theta patterns
dupes_k <- apply(theta_global_modes, 2, function(x)
identical(x,theta_global_modes[, unique_global_classes[k]]))
# Combine class proportions for all duplicated patterns together
pi_global_red[, k] <-
apply(as.matrix(post_MCMC_out$pi_global[, dupes_k]), 1, sum, na.rm = TRUE)
}
}
# Re-normalize to ensure pi sums to 1 for each iteration
pi_global_red = pi_global_red / rowSums(pi_global_red, na.rm = TRUE)
# Get posterior parameter samples for unique classes for theta
# Global theta: MxJxKxR
theta_global_red <- post_MCMC_out$theta_global[, , unique_global_classes, ,
drop = FALSE]
theta_global_red <- plyr::aaply(theta_global_red, c(1, 2, 3), function(x)
x / sum(x, na.rm = TRUE), .drop = FALSE) # Re-normalize
# Local theta: MxJxHxR
theta_local_red <- plyr::aaply(MCMC_out$theta_local_MCMC, c(1, 2, 3), function(x)
x / sum(x, na.rm = TRUE), .drop = FALSE) # Re-normalize
#============== Posterior median estimates ===================================
# Pi
pi_global_med <- apply(pi_global_red, 2, function(x)
stats::median(x, na.rm = TRUE))
pi_global_med <- pi_global_med / sum(pi_global_med, na.rm = TRUE)  # Re-normalize
# Theta
theta_global_med <- apply(theta_global_red, c(2, 3, 4), function(x)
stats::median(x, na.rm = TRUE))
theta_global_med <- plyr::aaply(theta_global_med, c(1, 2), function(x)
x / sum(x, na.rm = TRUE), .drop = FALSE)  # Re-normalize
theta_local_med <- apply(theta_local_red, c(2, 3, 4), function(x)
stats::median(x, na.rm = TRUE))
theta_local_med <- plyr::aaply(theta_local_med, c(1, 2), function(x)
x / sum(x, na.rm = TRUE), .drop = FALSE)  # Re-normalize
# Theta modes
theta_global_modes <- apply(theta_global_med, c(1, 2), which.max)
theta_local_modes <- apply(theta_local_med, c(1, 2), which.max)
# Nu
nu_red <- MCMC_out$nu_MCMC
nu_med <- apply(nu_red, c(2, 3), function(x) stats::median(x, na.rm = TRUE))
# Beta
beta_red <- MCMC_out$beta_MCMC
beta_med <- apply(beta_red, 2, function(x) stats::median(x, na.rm = TRUE))
#============== Update c using unique classes and posterior estimates ========
p_ij <- MCMC_out$p_ij_MCMC[M, , ]
# Global-local assignments to use for obtaining c_all and l_all
g_mat <- MCMC_out$g_mat_MCMC[M, , ]
# Posterior class membership probabilities
pred_global_class_probs <- matrix(NA, nrow = n, ncol = K_red)
# Individual log-likelihood for each class
log_cond_c <- matrix(NA, nrow = n, ncol = K_red)
# Calculate posterior class membership, p(c_i=k|-), for each class k
for (i in 1:n) {
for (k in 1:K_red) {
# Calculate theta component of individual log-likelihood assuming class k
log_global_theta_comp_k <- 0
for (j in 1:J) {
# Add in global thetas for items with global assignment
if (g_mat[i, j] == 1) {
log_global_theta_comp_k <- log_global_theta_comp_k +
log(theta_global_med[j, k, x_mat[i, j]])
}
}
# Individual log-likelihood for class k
log_cond_c[i, k] <- log(pi_global_med[k]) + log_global_theta_comp_k
}
# Calculate p(c_i=k|-) = p(x,y,c_i=k) / p(x,y)
pred_global_class_probs[i, ] <-
exp(log_cond_c[i, ] - matrixStats::logSumExp(log_cond_c[i, ], na.rm = TRUE))
# Update class assignment using the posterior probabilities
c_all[i] <- LaplacesDemon::rcat(n = 1, p = pred_global_class_probs[i, ])
}
#============== Update g using posterior estimates ===========================
# # Final global-local assignments for each item
# for (i in 1:n) {
#   h_i <- h_all[i]
#   p_i <- numeric(J)
#   # Posterior global-local assignment probability for each item
#   for (j in 1:J) {
#     global_prob <- nu_med[h_i, j] * theta_global_med[j, c_all[i], x_mat[i, j]]
#     local_prob <- (1 - nu_med[h_i, j]) * theta_local_med[j, h_i, x_mat[i, j]]
#     p_i[j] <- global_prob / (global_prob + local_prob)
#   }
#   # For each individual, assign items to global or local
#   g_mat[i, ] <- rbinom(n = J, size = 1, prob = p_i)
# }
estimates <- list(K_red = K_red, pi_global_red = pi_global_red,
theta_global_red = theta_global_red,
theta_local_red = theta_local_red,
pi_global_med = pi_global_med,
theta_global_med = theta_global_med,
theta_local_med = theta_local_med,
theta_global_modes = theta_global_modes,
theta_local_modes = theta_local_modes, c_all = c_all,
pred_global_class_probs = pred_global_class_probs,
g_mat = g_mat, p_ij = MCMC_out$p_ij, nu_med = nu_med, nu_red = nu_red,
beta_red = beta_red, beta_med = beta_med)
return(estimates)
}
estimates <- get_estimates_wrpc(MCMC_out = MCMC_out,
post_MCMC_out = post_MCMC_out, n = n, J = J,
H = H, R = R, x_mat = x_mat)
temp <- ifelse(estimates$p_ij > 0.5, 1, 0)
estimates$p_ij
source(paste0(wd, code_dir, "toy_helper_fns.R"))
n_runs <- 20000
burn <- n_runs / 2
thin <- 5
RPC_params <- list(pi_global = pi_global,
theta_global = theta_global, theta_local = theta_local,
beta = beta, nu = nu,
c_all = c_all, g_mat = g_mat)
set.seed(1)
MCMC_out <- run_MCMC_Rcpp_wrpc(RPC_params = RPC_params, n_runs = n_runs,
burn = burn, thin = thin, n = n, K = K, J = J,
R = R, H = H, w_all = w_all, h_all = h_all,
x_mat = x_mat,
alpha_global = alpha_global,
eta_global = eta_global, eta_local = eta_local,
alpha_nu = alpha_nu, a = a, b = b, update = 1000)
post_MCMC_out <- post_process_wrpc(MCMC_out = MCMC_out, J = J, R = R, H = H,
class_cutoff_global = 0.05)
estimates <- get_estimates_wrpc(MCMC_out = MCMC_out,
post_MCMC_out = post_MCMC_out, n = n, J = J,
H = H, R = R, x_mat = x_mat)
temp <- ifelse(estimates$p_ij > 0.5, 1, 0)
temp_diffs <- sim_samp$true_Gij - temp
sum(temp_diffs != 0)
head(estimates$p_ij)
round(head(estimates$p_ij), 3)
round(head(sim_samp$true_Gij))
nu_temp_est <- ifelse(estimates$nu_med > 0.5, 1, 0)
nu_temp_true <- ifelse(sim_samp$true_nu > 0.5, 1, 0)
sum(abs(nu_temp_ests - nu_temp_true))
sum(abs(nu_temp_est - nu_temp_true))
nu_temp_est
nu_temp_true
estimates$nu_med
#====================
# Analyzing HCHS data
#====================
rm(list = ls())
library(tidyverse)  # data wrangling
library(baysc)      # bayesian survey clustering
library(haven)      # read sas file
library(naniar)     # missingness
wd <- "~/Documents/Github/WRPC/"
code_dir <- "Code/"
data_dir <- "Data/"
res_dir <- "Results/"
sol_data <- read.csv(paste0(wd, data_dir, "FPQ129_CVD07FEB2023.csv"))
# Select diet variables
fpq_data <- sol_data %>%
select(ID, STRAT, PSU_ID, CENTER, BKGRD1_C6, fp2:fp1)
### Check site x background numbers
# Site: B=Bronx, C=Chicago, M=Miami, S=San Diego
# Background: 0=Dominican, 1=Central or South American, 2=Cuban, 3=Mexican, 4=Puerto Rican
# 5=More than one/Other heritage
# For Mexicans, Bronx: 163, Chicago: 2006, Miami: 29, San Diego: 3212
table(fpq_data$CENTER, fpq_data$BKGRD1_C6)
# Subset to Mexican background for Chicago and San Diego: total 5218
fpq_mex <- fpq_data %>%
filter(CENTER %in% c("C", "S") & BKGRD1_C6 == 3)
# Large population centers:
# Bronx-DR (1148)
# Bronx-PR (1449)
# [Chicago-C/SA (647)]
# [Chicago-PR (674)]
# Chicago-Mex (2006)
# Miami-C/SA (1357)
# Miami-Cuban (2089)
# San Diego-Mex (3212)
# Total: 6 groups = 11261; 8 groups = 12582
raw_derv_vars <- read_sas(paste0(wd, data_dir, "part_derv_inv4.sas7bdat"))
raw_fpq_vars <- read_sas(paste0(wd, data_dir, "fpe_inv4.sas7bdat"))
table(raw_derv_vars$HYPERTENSION2, useNA = "always")
table(raw_derv_vars$HYPERT_AWARENESS, useNA = "always")
table(raw_derv_vars$HYPERTENSION2, raw_derv_vars$HYPERT_AWARENESS,
useNA = "always")
table(raw_derv_vars$DYSLIPIDEMIA, useNA = "always")
table(raw_derv_vars$DIABETES2, useNA = "always")
par(mfrow = c(1,1))
par(mar=c(5,4,4,2)+0.1)
hist(raw_derv_vars$YRSUS)
hist(raw_derv_vars$AGE_IMMI)
table(raw_derv_vars$US_BORN)
yrsus_3cat <- raw_derv_vars %>% mutate(
YRSUS_C3 = case_when(
US_BORN == 1 ~ 1,
US_BORN == 0 & YRSUS >= 10 ~ 2,
US_BORN == 0 & YRSUS < 10 ~ 3,
.default = NA
))
table(yrsus_3cat$YRSUS_C3, useNA = "always")
# Subset to those with FPQ data
raw_derv_sub <- raw_derv_vars %>% filter(ID %in% fpq_data$ID)
# Create variable combining site and ethnicity for the largest sample sizes
raw_derv_sub <- raw_derv_sub %>% mutate(
site_eth = case_when(
CENTER == "B" & BKGRD1_C6 == 0 ~ "Bronx_DR",
CENTER == "B" & BKGRD1_C6 == 4 ~ "Bronx_PR",
CENTER == "C" & BKGRD1_C6 == 1 ~ "Chicago_CA_SA",
CENTER == "C" & BKGRD1_C6 == 4 ~ "Chicago_PR",
CENTER == "C" & BKGRD1_C6 == 3 ~ "Chicago_Mex",
CENTER == "M" & BKGRD1_C6 == 1 ~ "Miami_CA_SA",
CENTER == "M" & BKGRD1_C6 == 2 ~ "Miami_Cuban",
CENTER == "S" & BKGRD1_C6 == 3 ~ "SanDiego_Mex",
)
)
colnames(raw_derv_sub)
dtsa_inv4 <- read_sas(paste0(wd, data_dir, "dtsa_inv4.sas7bdat"))
colnames(dtsa_inv4)
library(tidyverse)  # data wrangling
library(baysc)      # bayesian survey clustering
library(haven)      # read sas file
library(naniar)     # missingness
wd <- "~/Documents/Github/WRPC/"
code_dir <- "Code/"
data_dir <- "Data/"
res_dir <- "Results/"
sol_data <- read.csv(paste0(wd, data_dir, "FPQ129_CVD07FEB2023.csv"))
# Select diet variables
fpq_data <- sol_data %>%
select(ID, STRAT, PSU_ID, CENTER, BKGRD1_C6, fp2:fp1)
### Check site x background numbers
# Site: B=Bronx, C=Chicago, M=Miami, S=San Diego
# Background: 0=Dominican, 1=Central or South American, 2=Cuban, 3=Mexican, 4=Puerto Rican
# 5=More than one/Other heritage
# For Mexicans, Bronx: 163, Chicago: 2006, Miami: 29, San Diego: 3212
table(fpq_data$CENTER, fpq_data$BKGRD1_C6)
# Subset to Mexican background for Chicago and San Diego: total 5218
fpq_mex <- fpq_data %>%
filter(CENTER %in% c("C", "S") & BKGRD1_C6 == 3)
# Large population centers:
# Bronx-DR (1148)
# Bronx-PR (1449)
# [Chicago-C/SA (647)]
# [Chicago-PR (674)]
# Chicago-Mex (2006)
# Miami-C/SA (1357)
# Miami-Cuban (2089)
# San Diego-Mex (3212)
# Total: 6 groups = 11261; 8 groups = 12582
raw_derv_vars <- read_sas(paste0(wd, data_dir, "part_derv_inv4.sas7bdat"))
raw_fpq_vars <- read_sas(paste0(wd, data_dir, "fpe_inv4.sas7bdat"))
table(raw_derv_vars$HYPERTENSION2, useNA = "always")
table(raw_derv_vars$HYPERT_AWARENESS, useNA = "always")
table(raw_derv_vars$HYPERTENSION2, raw_derv_vars$HYPERT_AWARENESS,
useNA = "always")
table(raw_derv_vars$DYSLIPIDEMIA, useNA = "always")
table(raw_derv_vars$DIABETES2, useNA = "always")
par(mfrow = c(1,1))
par(mar=c(5,4,4,2)+0.1)
hist(raw_derv_vars$YRSUS)
hist(raw_derv_vars$AGE_IMMI)
table(raw_derv_vars$US_BORN)
yrsus_3cat <- raw_derv_vars %>% mutate(
YRSUS_C3 = case_when(
US_BORN == 1 ~ 1,
US_BORN == 0 & YRSUS >= 10 ~ 2,
US_BORN == 0 & YRSUS < 10 ~ 3,
.default = NA
))
table(yrsus_3cat$YRSUS_C3, useNA = "always")
# Subset to those with FPQ data
raw_derv_sub <- raw_derv_vars %>% filter(ID %in% fpq_data$ID)
# Create variable combining site and ethnicity for the largest sample sizes
raw_derv_sub <- raw_derv_sub %>% mutate(
site_eth = case_when(
CENTER == "B" & BKGRD1_C6 == 0 ~ "Bronx_DR",
CENTER == "B" & BKGRD1_C6 == 4 ~ "Bronx_PR",
CENTER == "C" & BKGRD1_C6 == 1 ~ "Chicago_CA_SA",
CENTER == "C" & BKGRD1_C6 == 4 ~ "Chicago_PR",
CENTER == "C" & BKGRD1_C6 == 3 ~ "Chicago_Mex",
CENTER == "M" & BKGRD1_C6 == 1 ~ "Miami_CA_SA",
CENTER == "M" & BKGRD1_C6 == 2 ~ "Miami_Cuban",
CENTER == "S" & BKGRD1_C6 == 3 ~ "SanDiego_Mex",
)
)
table(raw_derv_vars$CENTER, raw_derv_vars$BKGRD1_C6)
colnames(raw_derv_vars)
# Look at distribution of various variables
# GPAQ = physical activity
# AHI_GE15 = sleep apnea
vars_summ <- raw_derv_vars %>%
select(AGE, GENDER, CIGARETTE_PACK_YEARS_C3, ALCOHOL_USE_LEVEL, GPAQ_level,
DIAB_FamHist, FH_CHD, FH_Stroke, EVER_ANGINA_RELATIVE,
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,
CKD, AHI_GE15, COPD_BY_BD)
# Look at distribution of various variables
# GPAQ = physical activity
# AHI_GE15 = sleep apnea
vars_summ <- raw_derv_vars %>%
select(AGE, GENDER, CIGARETTE_PACK_YEARS_C3, ALCOHOL_USE_LEVEL, GPAQ_LEVEL,
DIAB_FamHist, FH_CHD, FH_Stroke, EVER_ANGINA_RELATIVE,
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,
CKD, AHI_GE15, COPD_BY_BD)
# Look at distribution of various variables
# GPAQ = physical activity
# AHI_GE15 = sleep apnea
vars_summ <- raw_derv_vars %>%
select(AGE, GENDER, CIGARETTE_PACK_YEARS_C3, ALCOHOL_USE_LEVEL, GPAQ_LEVEL,
DIAB_FAMHIST, FH_CHD, FH_Stroke, EVER_ANGINA_RELATIVE,
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,
CKD, AHI_GE15, COPD_BY_BD)
# Look at distribution of various variables
# GPAQ = physical activity
# AHI_GE15 = sleep apnea
vars_summ <- raw_derv_vars %>%
select(AGE, GENDER, CIGARETTE_PACK_YEARS_C3, ALCOHOL_USE_LEVEL, GPAQ_LEVEL,
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE,
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,
CKD, AHI_GE15, COPD_BY_BD)
summary(vars_summ)
summary(vars_summ$AGE)
apply(vars_summ, 2, table, useNA = "always")
apply(vars_summ, 2, function(x) prop.table(table(x, useNA = "always")))
apply(vars_summ, 2, function(x) round(prop.table(table(x, useNA = "always")), 2))
apply(vars_summ[, -1], 2, function(x) round(prop.table(table(x, useNA = "always")), 2))
table(raw_derv_vars$CURRENT_SMOKER, useNA = "always")
table(raw_derv_vars$CIGARETTE_USE, useNA = "always")
table(raw_derv_vars$ALCOHOL_USE, useNA = "always")
# Look at distribution of various variables
vars_summ <- raw_derv_vars %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 431 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 93 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 140 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 65 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~200 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~200 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 168 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 1946 NAs
COPD_BY_BD  # 1=yes. 15244 NAs
)
summary(vars_summ$AGE)
apply(vars_summ[, -1], 2, function(x)
round(prop.table(table(x, useNA = "always")), 2))
# Look at distribution of various variables
vars_summ <- raw_derv_vars %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 431 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 93 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 140 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 65 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low. 140 NAs
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~200 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~200 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 168 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 1946 NAs
COPD_BY_BD,  # 1=yes. 15244 NAs
MED_LLD, # lipid lowering drugs/antihyperlipidemics. 1=yes.
MED_ANTIDIAB, # Antidiabetics. 1=yes
MED_ANTIHYPERT, # Antihypertensives. 1=yes
)
apply(vars_summ[, -1], 2, function(x)
round(prop.table(table(x, useNA = "always")), 2))
apply(vars_summ[, -1], 2, function(x) table(x, useNA = "always"))
# Repeat for ages 30 to 74
raw_derv_vars_agerestr <- raw_derv_vars %>%
filter(AGE >= 30 & AGE <= 74)
vars_summ <- raw_derv_vars_agerestr %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 431 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 93 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 140 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 65 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low. 140 NAs
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~200 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~200 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 168 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 1946 NAs
COPD_BY_BD,  # 1=yes. 15244 NAs
MED_LLD, # lipid lowering drugs/antihyperlipidemics. 1=yes. 394 NAs
MED_ANTIDIAB, # Antidiabetics. 1=yes. 394 NAs
MED_ANTIHYPERT, # Antihypertensives. 1=yes. 394 NAs
)
summary(vars_summ$AGE)
dim(raw_derv_vars_agerestr)
dim(vars_summ)
# Look at distribution of various variables
vars_summ <- raw_derv_vars %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 431 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 93 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 140 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 65 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low. 140 NAs
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~200 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~200 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 168 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 1946 NAs
COPD_BY_BD,  # 1=yes. 15244 NAs
MED_LLD, # lipid lowering drugs/antihyperlipidemics. 1=yes. 394 NAs
MED_ANTIDIAB, # Antidiabetics. 1=yes. 394 NAs
MED_ANTIHYPERT, # Antihypertensives. 1=yes. 394 NAs
)
dim(vars_summ)
# Repeat for ages 30 to 74
raw_derv_vars_agerestr <- raw_derv_vars %>%
filter(AGE >= 30 & AGE <= 74)
vars_summ <- raw_derv_vars_agerestr %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 431 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 93 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 140 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 65 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low. 140 NAs
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~200 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~200 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 168 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 1946 NAs
COPD_BY_BD,  # 1=yes. 15244 NAs
MED_LLD, # lipid lowering drugs/antihyperlipidemics. 1=yes. 394 NAs
MED_ANTIDIAB, # Antidiabetics. 1=yes. 394 NAs
MED_ANTIHYPERT, # Antihypertensives. 1=yes. 394 NAs
)
dim(vars_summ)
summary(vars_summ$AGE)
apply(vars_summ[, -1], 2, function(x)
round(prop.table(table(x, useNA = "always")), 2))
apply(vars_summ[, -1], 2, function(x) table(x, useNA = "always"))
# Repeat for ages 30 to 74 and Puerto Rican ethnicity
raw_derv_vars_age_PR <- raw_derv_vars %>%
filter(AGE >= 30 & AGE <= 74 & BKGRD1_C6 == 4)
vars_summ <- raw_derv_vars_age_PR %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 360 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 80 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 66 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 61 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low. 106 NAs
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~150 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~150 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 125 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 1577 NAs
COPD_BY_BD,  # 1=yes. 12736 NAs
MED_LLD, # lipid lowering drugs/antihyperlipidemics. 1=yes. 338 NAs
MED_ANTIDIAB, # Antidiabetics. 1=yes. 338 NAs
MED_ANTIHYPERT, # Antihypertensives. 1=yes. 338 NAs
)
dim(vars_summ)
# Repeat for ages 30 to 74 and Puerto Rican ethnicity
raw_derv_vars_age_PR <- raw_derv_vars %>%
filter(AGE >= 30 & AGE <= 74 & BKGRD1_C6 == 4)
vars_summ <- raw_derv_vars_age_PR %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 360 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 80 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 66 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 61 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low. 106 NAs
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~150 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~150 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 125 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 1577 NAs
COPD_BY_BD,  # 1=yes. 12736 NAs
MED_LLD, # lipid lowering drugs/antihyperlipidemics. 1=yes. 338 NAs
MED_ANTIDIAB, # Antidiabetics. 1=yes. 338 NAs
MED_ANTIHYPERT, # Antihypertensives. 1=yes. 338 NAs
)
dim(vars_summ)  # n=2337
summary(vars_summ$AGE)
apply(vars_summ[, -1], 2, function(x)
round(prop.table(table(x, useNA = "always")), 2))
apply(vars_summ[, -1], 2, function(x) table(x, useNA = "always"))
raw_derv_vars_PR <- raw_derv_vars %>%
filter(BKGRD1_C6 == 4)
vars_summ <- raw_derv_vars_PR %>%
select(AGE, GENDER,
CIGARETTE_PACK_YEARS_C3, # 1: 0, 2: 0-10, 3: >10. 43 NAs
CIGARETTE_USE, # 1: never, 2: former, 3: current. 6 NAs
ALCOHOL_USE_LEVEL, # 1: no current, 2: low level, 3: high level. 4 NAs
ALCOHOL_USE, # 1: never, 2: former, 3: current. 3 NAs
GPAQ_LEVEL, # Physical activity. 1:high, 2: moderate, 3: low. 12 NAs
DIAB_FAMHIST, FH_CHD, FH_STROKE, EVER_ANGINA_RELATIVE, # 0: No, 1: Yes. ~40 NAs
EVER_MI_RELATIVE, EVER_CABG_RELATIVE,  # 0: No, 1: Yes. ~30 NAs
CKD, # 1:normal, 2:mild, 3:moderate, 4:severe, 5:end-stage. 40 NAs
AHI_GE15, # Sleep apnea. 1=yes. # 356 NAs
COPD_BY_BD,  # 1=yes. 2131 NAs
MED_LLD, # lipid lowering drugs/antihyperlipidemics. 1=yes. 64 NAs
MED_ANTIDIAB, # Antidiabetics. 1=yes. 64 NAs
MED_ANTIHYPERT, # Antihypertensives. 1=yes. 64 NAs
)
dim(vars_summ)  # n=2337
summary(vars_summ$AGE)
apply(vars_summ[, -1], 2, function(x)
round(prop.table(table(x, useNA = "always")), 2))
apply(vars_summ[, -1], 2, function(x) table(x, useNA = "always"))
### Check site x background numbers
# Site: B=Bronx, C=Chicago, M=Miami, S=San Diego
# Background: 0=Dominican, 1=Central or South American, 2=Cuban, 3=Mexican, 4=Puerto Rican
# 5=More than one/Other heritage
# For Mexicans, Bronx: 163, Chicago: 2006, Miami: 29, San Diego: 3212
table(fpq_data$CENTER, fpq_data$BKGRD1_C6)
### Check site x background numbers
# Site: B=Bronx, C=Chicago, M=Miami, S=San Diego
# Background: 0=Dominican, 1=Central or South American, 2=Cuban, 3=Mexican, 4=Puerto Rican
# 5=More than one/Other heritage
# For Mexicans, Bronx: 163, Chicago: 2006, Miami: 29, San Diego: 3212
table(fpq_data$CENTER)
### Check site x background numbers
# Site: B=Bronx, C=Chicago, M=Miami, S=San Diego
# Background: 0=Dominican, 1=Central or South American, 2=Cuban, 3=Mexican, 4=Puerto Rican
# 5=More than one/Other heritage
# For Mexicans, Bronx: 163, Chicago: 2006, Miami: 29, San Diego: 3212
table(fpq_data$BKGRD1_C6)
table(raw_derv_vars$CVD_FRAME)
prop.table(table(raw_derv_vars$CVD_FRAME))
